var $jscomp={scope:{},findInternal:function(b,l,e){b instanceof String&&(b=String(b));for(var m=b.length,f=0;f<m;f++){var u=b[f];if(l.call(e,u,f,b))return{i:f,v:u}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,l,e){if(e.get||e.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[l]=e.value)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,l,e,m){if(l){e=$jscomp.global;b=b.split(".");for(m=0;m<b.length-1;m++){var f=b[m];f in e||(e[f]={});e=e[f]}b=b[b.length-1];m=e[b];l=l(m);l!=m&&null!=l&&$jscomp.defineProperty(e,b,{configurable:!0,writable:!0,value:l})}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,e){return $jscomp.findInternal(this,b,e).v}},"es6-impl","es3");
(function(b,l,e,m){function f(b){var g=Math.floor(b/60),e=Math.floor(g/60);b=Math.floor(b%60);return(0<e?e+":":"")+("0"+g%60).slice(-2)+":"+("0"+b).slice(-2)}function u(b){var e=b.outerWidth();b.removeClass("audioplayer-layout-480");b.removeClass("audioplayer-layout-600");b.removeClass("audioplayer-layout-900");440<=e&&b.addClass("audioplayer-layout-480");600<=e&&b.addClass("audioplayer-layout-600");900<=e&&b.addClass("audioplayer-layout-900")}function N(e,f){var g=f.hasClass("audioplayer-playing");
e?(b(".audioplayer__fullscreen").length||b("body").append('<div class="audioplayer__fullscreen m-hidden"></div>'),f.wrap('<div class="audioplayer__holder"></div>'),b(".audioplayer__fullscreen").removeClass("m-hidden").append(f),ria.disablePageScroll(!0)):(b(".audioplayer__holder").append(f),b(".audioplayer__fullscreen").addClass("m-hidden"),f.unwrap('<div class="audioplayer__holder"></div>'),ria.disablePageScroll(!1));u(f);g&&f.find("audio").get(0).play()}var w="ontouchstart"in l,O=w?"touchstart":
"mousedown",y=w?"touchmove":"mousemove",P=w?"touchcancel":"mouseup";b.fn.audioPlayer=function(g){function m(b){a.addClass(h.modal).attr("data-state","modal-"+b);a.find(".audioplayer__"+b).addClass("active");480>e.documentElement.clientWidth&&N(!0,a)}function M(b){a.removeClass(h.modal).attr("data-state","");b.removeClass("active");a.parent().hasClass("audioplayer__fullscreen")&&N(!1,a)}if(this.length&&(1!=this.length||!b(this).hasClass("audioplayer-inited"))){g=b.extend({classPrefix:"audioplayer",
strings:{play:"\u0412\u043e\u0441\u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0441\u0442\u0438",pause:"\u041f\u0440\u0438\u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c",volume:"\u0413\u0440\u043e\u043c\u043a\u043e\u0441\u0442\u044c",speed:"\u0421\u043a\u043e\u0440\u043e\u0441\u0442\u044c \u0432\u043e\u0441\u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d\u0438\u044f",download:"\u0421\u043a\u0430\u0447\u0430\u0442\u044c",subscribe:"\u041f\u043e\u0434\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f",
more:"\u0421\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0432\u0441\u0435 \u044d\u043f\u0438\u0437\u043e\u0434\u044b",about:"\u041e \u0432\u044b\u043f\u0443\u0441\u043a\u0435"}},g);var h={},r={playing:"playing",stopped:"stopped",noVolume:"novolume",muted:"muted",modal:"modal"},p;for(p in r)h[p]=g.classPrefix+"-"+r[p];if(1<this.length)return this.each(function(){b(this).audioPlayer(g)}),this;var a=b(this),c=a.find("audio").get(0);u(a);b(l).resize(function(){u(a)});r="";""!=a.data("rubric")&&(r='<div class="audioplayer__subscribe audioplayer__top-button"><div class="audioplayer__subscribe-button"><span><svg class="svg-icon"><use xlink:href="#icon-e-mail_small" /></svg></span><span>'+
g.strings.subscribe+'</span></div><div class="audioplayer__subscribe-list"><ul>'+(""!=a.data("subscribe-itunes")?'<li><a href="'+a.data("subscribe-itunes")+'" target="_blank">iTunes</a></li>':"")+(""!=a.data("subscribe-googlepodcasts")?'<li><a href="'+a.data("subscribe-googlepodcasts")+'" target="_blank">Google</a></li>':"")+(""!=a.data("subscribe-tunein")?'<li><a href="'+a.data("subscribe-tunein")+'" target="_blank">TuneIn</a></li>':"")+(""!=a.data("subscribe-castbox")?'<li><a href="'+a.data("subscribe-castbox")+
'" target="_blank">Castbox</a></li>':"")+(""!=a.data("subscribe-soundstream")?'<li><a href="'+a.data("subscribe-soundstream")+'" target="_blank">Soundstream</a></li>':"")+(""!=a.data("subscribe-yandexmusic")?'<li><a href="'+a.data("subscribe-yandexmusic")+'" target="_blank">\u042f\u043d\u0434\u0435\u043a\u0441.\u041c\u0443\u0437\u044b\u043a\u0430</a></li>':"")+(""!=a.data("subscribe-rss")?'<li><a href="'+a.data("subscribe-rss")+'" target="_blank">RSS</a></li>':"")+'<li class="hidden"><a href="/" class="audioplayer__ria-subscribe">Ria.ru</a></li></ul></div></div>');
var z=p="",A="",x="";a.hasClass("audioplayer-vast")||(p='<div class="audioplayer__controls-right"><div class="audioplayer__controls-download" title="'+g.strings.download+'"><a href="'+c.src+'" download="podcast" target="_blank"><svg class="svg-icon"><use xlink:href="#icon-download" /></svg></a></div><div class="audioplayer__controls-share"><span class="share" data-nosnippet="true" data-id="'+a.data("articleid")+'" data-url="'+location.href+'" data-title="'+a.data("media-title").replace(/\\"/g,"&quot;")+
'"></span></div></div>',z='<div class="audioplayer__controls-download audioplayer__top-button" title="'+g.strings.download+'"><a href="'+c.src+'" download="podcast" target="_blank"><span><svg class="svg-icon"><use xlink:href="#icon-download" /></svg></span><span>'+g.strings.download+"</span></a></div>",A='<div class="audioplayer__modal audioplayer__playlist"><div class="audioplayer__modal-close"><svg class="svg-icon"><use xlink:href="#icon-close" /></svg></div><div class="audioplayer__playlist-info"><div class="audioplayer__playlist-title">'+
a.data("rubric-title").replace(/\\"/g,'"')+'</div><div class="audioplayer__playlist-text">'+a.data("rubric-subtitle").replace(/\\"/g,'"')+'</div><a href="'+a.data("rubric-url")+'" class="audioplayer__playlist-more">'+g.strings.more+'</a></div><div class="audioplayer__playlist-list"><div class="audioplayer__playlist-list-content"></div></div></div>',x='<div class="audioplayer__modal audioplayer__about"><div class="audioplayer__modal-close"><svg class="svg-icon"><use xlink:href="#icon-close" /></svg></div><div class="audioplayer__about-title">'+
a.data("media-title").replace(/\\"/g,'"')+'</div><div class="audioplayer__about-text"><div class="audioplayer__about-text-content">'+a.data("media-descr").replace(/\\"/g,'"')+"</div></div></div>");a.append('<div class="audioplayer__controls hidden"><div class="audioplayer__current-time"></div><div class="audioplayer__total-time"></div><div class="audioplayer__controls-seekbar"><div class="audioplayer__controls-seekbar-line"><div class="audioplayer__controls-seekbar-all"></div><div class="audioplayer__controls-seekbar-loaded"></div><div class="audioplayer__controls-seekbar-played"></div></div></div><div class="audioplayer__controls-left"><div class="audioplayer__controls-volume"><div class="audioplayer__controls-volume-button" title="'+
g.strings.volume+'"><svg class="svg-icon"><use xlink:href="#icon-sound" /></svg><svg class="svg-icon"><use xlink:href="#icon-mute" /></svg></div><div class="audioplayer__controls-volume-adjust"><div><div></div></div></div></div><div class="audioplayer__controls-speed"><div class="audioplayer__controls-speed-button" title="'+g.strings.speed+'"><svg class="svg-icon"><use xlink:href="#icon-close_small" /></svg><span>1</span></div><div class="audioplayer__controls-speed-list"><ul><li data-value="0.8">0,8</li><li data-value="1" class="active">1</li><li data-value="1.5">1,5</li><li data-value="2">2</li></ul></div></div></div><div class="audioplayer__controls-center"><div class="audioplayer__controls-rw"><svg class="svg-icon"><use xlink:href="#icon-backward" /></svg></div><div class="audioplayer__controls-play" title="'+
g.strings.play+'"><svg class="svg-icon"><use xlink:href="#icon-play_small" /></svg><svg class="svg-icon"><use xlink:href="#icon-pause_small" /></svg></div><div class="audioplayer__controls-fw"><svg class="svg-icon"><use xlink:href="#icon-forward" /></svg></div></div>'+p+"</div>"+r+'<div class="audioplayer__prev hidden"><svg class="svg-icon"><use xlink:href="#icon-left_single" /></svg></div><div class="audioplayer__next hidden"><svg class="svg-icon"><use xlink:href="#icon-right_single" /></svg></div><div class="audioplayer__about-button audioplayer__top-button"><span>i</span><span>'+
g.strings.about+"</span></div>"+z+A+x);var k=a.find(".audioplayer__controls"),r=k.find(".audioplayer__controls-play");p=k.find(".audioplayer__controls-rw");var z=k.find(".audioplayer__controls-fw"),B=k.find(".audioplayer__current-time"),Q=k.find(".audioplayer__total-time"),t=k.find(".audioplayer__controls-seekbar"),V=t.find(".audioplayer__controls-seekbar-played"),W=t.find(".audioplayer__controls-seekbar-loaded"),A=k.find(".audioplayer__controls-volume-button"),v=k.find(".audioplayer__controls-volume-adjust > div"),
C=0,D=!1,E=!1,F=!1,G=!1,H=!1,I=!1,R=k.find(".audioplayer__controls-speed-button"),x=k.find(".audioplayer__controls-speed li"),J=a.find(".audioplayer__prev"),K=a.find(".audioplayer__next"),L=a.find(".audioplayer__ria-subscribe"),S=function(a){realEvent=w?a.originalEvent.touches[0]:a;c.currentTime=Math.round(c.duration*(realEvent.pageX-t.offset().left)/t.width())},T=function(a){realEvent=w?a.originalEvent.touches[0]:a;a=Math.abs((realEvent.pageY-(v.offset().top+85))/85);c.volume=1<a?1:a;ria.lsSet("audio_volume",
c.volume)},X=function(){var a=setInterval(function(){if(1>c.buffered.length)return!0;W.width(c.buffered.end(0)/c.duration*100+"%");Math.floor(c.buffered.end(0))>=Math.floor(c.duration)&&clearInterval(a)},500)},d={};d.url=a.data("vast");var q="",U=function(c){b.ajax({url:"/services/mailing/subscribe/?newsletter_id="+a.data("subscribe-ria2")+"&email="+c,dataType:"json",beforeSend:function(a){}}).done(function(a){"OK"==a.status&&b(".js-subscribe").addClass("m-done")})};if(L.length)L.on("click",function(){GLOBAL.user.mail?
U(GLOBAL.user.mail):modalLayer.open({preset:"authorization",beforeOpen:function(){if(!b(".modal__main-desc").length){var a=b("<div />").addClass("modal__main-desc").text("\u0414\u043b\u044f \u043f\u043e\u0434\u043f\u0438\u0441\u043a\u0438 \u043d\u0430 \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0443 \u0432\u0430\u043c \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0438\u043b\u0438 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f");
b(".modal__content.modal__auth").prepend(a)}GLOBAL.events.subscribe("login",function(a){"success"==a.status&&U(a.user.email)});if(b(".modal__main-desc").length)b(l).on("changeModalLayer",function(){b(".modal__main-desc").remove()})},afterClose:function(){b(".modal__main-desc").remove()}});return!1});k.removeClass("hidden");var k=c.volume,Y=c.volume=0;Math.round(1E3*c.volume)/1E3==Y?c.volume=k:a.addClass(h.noVolume);k=b('form[data-ajax="/services/mailing/subscribe/"]').attr("data-newsletter");""!=
a.data("rubric")&&b.ajax({url:"/services/audio/"+a.data("rubric")+"/"+(k?"?cta_newsletter_id="+k:""),dataType:"json"}).done(function(c){if(c.items.length){var n="",d=c.items.length;a.find(".audioplayer__rubric span").html(100>c.items.length?" <span>"+d+"</span>/"+d:" 99+");b.each(c.items,function(b,c){var e=c.id==a.data("import-id")?" active":"";""!=e&&(a.find(".audioplayer__rubric span > span").text(d),a.find(".share").attr({"data-url":c.url,"data-id":c.articleid}));var g="";ria.lsGet("audio_progress_"+
c.id)&&(g=" / <span>"+f(ria.lsGet("audio_progress_"+c.id))+"</span>");n+='<div class="audioplayer__playlist-item'+e+'" data-src="'+c.mp3+'" data-text="'+c.text.replace(/"/g,"&quot;")+'" data-cover="'+c.img+'" data-id="'+c.id+'" data-url="'+c.url+'" data-articleid="'+c.articleid+'"><div class="audioplayer__playlist-item-icon"><svg class="svg-icon"><use xlink:href="#icon-play_small" /></svg></div><div class="audioplayer__playlist-item-pos">'+d+'</div><div class="audioplayer__playlist-item-main"><div class="audioplayer__playlist-item-title">'+
c.title+'</div><div class="audioplayer__playlist-item-duration">'+f(c.duration)+g+'</div></div><div class="audioplayer__playlist-item-date">'+c.date+"</div></div>";d--});a.find(".audioplayer__playlist-list-content").html(n);a.find(".audioplayer__playlist-list").theinScroll()}1<c.items.length?(J.removeClass("hidden"),K.removeClass("hidden")):(J.addClass("hidden"),K.addClass("hidden"));"undefined"!==typeof c.subscription_id&&""!=c.subscription_id&&(a.attr("data-subscribe-ria2",c.subscription_id),L.parent().removeClass("hidden"))}).fail(function(a,
b){});"undefined"!==typeof d&&"undefined"!==typeof d.url&&(q="banner_",b.ajax({url:d.url}).done(function(n){var e=b(n).find("MediaFile").text().trim();c.src=e;c.addEventListener("loadedmetadata",function(){a.removeClass("audioplayer-splash")});n=b(n).find("TrackingEvents");d.tracking1=n.find('Tracking[event="start"]').text().trim();d.tracking2=n.find('Tracking[event="firstQuartile"]').text().trim();d.tracking3=n.find('Tracking[event="midpoint"]').text().trim();d.tracking4=n.find('Tracking[event="thirdQuartile"]').text().trim();
d.tracking5=n.find('Tracking[event="complete"]').text().trim();d.tracking6=n.find('Tracking[event="pause"]').text().trim()}).fail(function(a,b){}));c.volume=ria.lsGet("audio_volume")?ria.lsGet("audio_volume"):1;v.find("div").height(100*c.volume+"%");C=c.volume;B.text(f(0));Q.text(b.isNumeric(c.duration)?f(c.duration):"");c.playbackRate=ria.lsGet("audio_playbackrate")?ria.lsGet("audio_playbackrate"):1;R.find("span").text(c.playbackRate);x.removeClass("active").filter('[data-value="'+c.playbackRate+
'"]').addClass("active");c.addEventListener("loadedmetadata",function(){X();B.text(f(0));Q.text(b.isNumeric(c.duration)?f(c.duration):"...")});c.addEventListener("playing",function(){b(".audioplayer").find("audio").each(function(){b(this).get(0)!=c&&b(this).get(0).pause()});a.addClass(h.playing).removeClass(h.stopped);a.removeClass("audioplayer-splash");b("body").trigger("audioplayer",["playing",a.attr("data-import-id")])});c.addEventListener("pause",function(){a.removeClass(h.playing).addClass(h.stopped);
b("body").trigger("audioplayer",["pause",a.attr("data-import-id")]);"undefined"!==typeof d&&"undefined"!==typeof d.tracking6&&fetch(d.tracking6)});c.addEventListener("ended",function(){a.removeClass(h.playing).addClass(h.stopped);b("body").trigger("audioplayer",["ended",a.attr("data-import-id")]);dataLayer.push({event:q+"Finished",gaEventCategory:"HTML5_Audio_Podcasts",gaEventAction:"Finished",gaEventLabel:a.attr("data-media-title"),player_rubric:a.attr("data-podcast")});"undefined"!==typeof d&&"undefined"!==
typeof d.tracking5&&fetch(d.tracking5)});c.addEventListener("timeupdate",function(){var b=c.currentTime/c.duration*100;B.text(f(this.currentTime));V.width(b+"%");ria.lsSet("audio_progress_"+a.attr("data-import-id"),c.currentTime);!D&&0<c.currentTime&&3>c.currentTime&&(dataLayer.push({event:q+"Play",gaEventCategory:"HTML5_Audio_Podcasts",gaEventAction:"Play",gaEventLabel:a.attr("data-media-title"),player_rubric:a.attr("data-podcast")}),"undefined"!==typeof d&&"undefined"!==typeof d.tracking1&&fetch(d.tracking1),
D=!0);1<=b&&!E&&(dataLayer.push({event:q+"1%",gaEventCategory:"HTML5_Audio_Podcasts",gaEventAction:"1%",gaEventLabel:a.attr("data-media-title"),player_rubric:a.attr("data-podcast")}),E=!0);25<=b&&!F&&(dataLayer.push({event:q+"25%",gaEventCategory:"HTML5_Audio_Podcasts",gaEventAction:"25%",gaEventLabel:a.attr("data-media-title"),player_rubric:a.attr("data-podcast")}),"undefined"!==typeof d&&"undefined"!==typeof d.tracking2&&fetch(d.tracking2),F=!0);50<=b&&!G&&(dataLayer.push({event:q+"50%",gaEventCategory:"HTML5_Audio_Podcasts",
gaEventAction:"50%",gaEventLabel:a.attr("data-media-title"),player_rubric:a.attr("data-podcast")}),"undefined"!==typeof d&&"undefined"!==typeof d.tracking3&&fetch(d.tracking3),G=!0);75<=b&&!H&&(dataLayer.push({event:q+"75%",gaEventCategory:"HTML5_Audio_Podcasts",gaEventAction:"75%",gaEventLabel:a.attr("data-media-title"),player_rubric:a.attr("data-podcast")}),"undefined"!==typeof d&&"undefined"!==typeof d.tracking4&&fetch(d.tracking4),H=!0);90<=b&&!I&&(dataLayer.push({event:q+"90%",gaEventCategory:"HTML5_Audio_Podcasts",
gaEventAction:"90%",gaEventLabel:a.attr("data-media-title"),player_rubric:a.attr("data-podcast")}),I=!0)});c.addEventListener("volumechange",function(){v.find("div").height(100*c.volume+"%");0<c.volume&&a.hasClass(h.muted)&&(a.removeClass(h.muted),c.muted=!1);0>=c.volume&&!a.hasClass(h.muted)&&(a.addClass(h.muted),c.muted=!0)});t.on(O,function(a){S(a);t.on(y,function(a){S(a)})}).on(P,function(){t.unbind(y)});A.on("click",function(){a.hasClass(h.muted)?(a.removeClass(h.muted),c.muted=!1,c.volume=C):
(a.addClass(h.muted),c.muted=!0,C=c.volume,c.volume=0)});v.on(O,function(a){T(a);v.on(y,function(a){T(a)})}).on(P,function(){v.unbind(y)});r.on("click",function(){a.hasClass(h.playing)?(b(this).attr("title",g.strings.play),c.pause()):(b(this).attr("title",g.strings.pause),c.play())});p.on("click",function(){c.currentTime-=30});z.on("click",function(){c.currentTime+=30});x.on("click",function(){c.playbackRate=b(this).data("value");R.find("span").text(b(this).text());ria.lsSet("audio_playbackrate",
c.playbackRate);b(this).addClass("active").siblings().removeClass("active")});a.find(".audioplayer__about-text").theinScroll();a.find(".audioplayer__rubric a").on("click",function(b){a.find(".audioplayer__playlist-item").length&&(b.preventDefault(),m("playlist"))});a.find(".audioplayer__about-button").on("click",function(){m("about")});a.find(".audioplayer__modal-close").on("click",function(){M(b(this).parent())});a.find(".audioplayer__playlist-list").on("click",".audioplayer__playlist-item",function(){var d=
b(this).data("id"),e=b(this).data("src"),f=b(this).data("cover"),g=b(this).find(".audioplayer__playlist-item-title").text(),h=b(this).data("url"),k=b(this).data("articleid"),l=b(this).data("text"),m=b(this).find(".audioplayer__playlist-item-pos").text(),p=c.playbackRate;b(this).addClass("active").siblings().removeClass("active");M(b(this).closest(".audioplayer__modal"));""!=f?a.removeClass("audioplayer-nocover").find(".audioplayer__cover").css("background-image","url("+f+")"):a.addClass("audioplayer-nocover").find(".audioplayer__cover").css("background-image",
"none");a.attr("data-import-id",d);a.attr("data-media-title",g);a.find(".audioplayer__about-title").html(g);a.find(".audioplayer__rubric span > span").text(m);a.find(".audioplayer__title").html(g);a.find(".audioplayer__about-text-content").html(l);a.find(".audioplayer__controls-download a").attr("href",e);a.find(".share").attr({"data-url":h,"data-title":g,"data-id":k});c.src=e;I=H=G=F=E=D=!1;c.load();c.playbackRate=p;c.play()});J.on("click",function(){a.find(".audioplayer__playlist-item.active").next().length?
a.find(".audioplayer__playlist-item.active").next().click():a.find(".audioplayer__playlist-item:first").click()});K.on("click",function(){a.find(".audioplayer__playlist-item.active").prev().length?a.find(".audioplayer__playlist-item.active").prev().click():a.find(".audioplayer__playlist-item:last").click()});this.play=function(){c.play()};this.pause=function(){c.pause()};this.playitem=function(b){a.find(".audioplayer__playlist-item[data-id="+b+"]").click()};a.find(".audioplayer__title").on("click",
function(){a.hasClass("audioplayer-splash")&&c.play()});a.addClass("audioplayer-inited");return this}}})(jQuery,window,document);$(function(){$(".audioplayer").audioPlayer()});
