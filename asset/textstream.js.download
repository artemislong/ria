var $jscomp={scope:{},findInternal:function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6-impl","es3");
$(document).ready(function(){onlineStream={elems:{article:"#online",articleList:"#online_list",onlineItem:".online__item",widget:"#online_widget",widgetList:"#online_widget_list",widgetHead:"#online_widget_head",caption:".online__caption",captionContent:".online__caption-content",sort:".online__sort",sortCtrl:".online__sort-button"},params:{isLoading:!1,isLoaded:!1,dataAjax:{sort:"desc",on_page:"20",inclusive:"0",get:"next",order:"new_first"}},urls:{list:"/services/online/list_block/",menu:"/services/online/menu/",
menu_block:"/services/online/menu_block/"},init:function(){var a=this;$("body");var b=$(this.elems.article),c=$("#widgetRLive .r-list__item");$("#widgetRLive .live");a.params.dataAjax.id=b.data("article-id");a.params.dataAjax.from=b.data("sortkey");$(a.elems.articleList).length&&a.getByScroll(a.elems.articleList);a.sortMsg();a.getAuto();a.captionMsg();c.on("click",function(){var c=$(this).data("id");a.params.dataAjax.id=c;a.params.isLoaded=!1;$(a.elems.widgetList).attr({"data-list-id":c});a.getWidgetTop(c);
a.getMsg(a.elems.widgetList,!1)});$("body").on("widget",function(a,b,f){"live"==b&&f&&1==c.length&&c.eq(0).trigger("click")});$("#widgetRLive .live").theinScroll();$("#widgetRLive .live").trigger("add-scrolling-trigger.the-in-scroll",[{name:"live_loadmore",position:1,sign:"<",down:!0,everytime:!1,move:!0,once:!1}]);$("#widgetRLive .live").on("live_loadmore.the-in-scroll",function(c){a.params.isLoading||a.params.isLoaded||a.getMsg(a.elems.widgetList,!0)})},setParam:function(a,b){b?this.params.dataAjax[a]=
b:delete this.params.dataAjax[a];return this},getMsg:function(a,b){var c=this;$.ajax({url:c.urls.list,data:c.params.dataAjax,beforeSend:function(){c.params.isLoading=!0;$(a).addClass("m-load")},complete:function(b){$(a).removeClass("m-load");c.params.isLoading=!1;c.params.dataAjax.order="asc"==c.params.dataAjax.sort?"old_first":"new_first"}}).done(function(d){var e=$(d);e.length?("prepend"==b?$(a).prepend(e):b?$(a).append(e):$(a).html(e),c.getView(e),"previous"==c.params.dataAjax.get?c.setParam("from",
$(a).children().last().attr("data-sortkey")):c.setParam("from",$(d).last().attr("data-sortkey"))):("next"==c.params.dataAjax.get&&(c.params.isLoaded=!0),"previous"==c.params.dataAjax.get&&c.deleteMoreBtn())});return this},getByScroll:function(a){var b=this;$(window).on("scroll",function(c){$(window).scrollTop()>=$(a).height()&&!b.params.isLoaded&&!b.params.isLoading&&(c=$(a).find(".online__item").last().data("sortkey"),b.setParam("from",c).setParam("get","next").setParam("inclusive",0).getMsg(a,!0))})},
getView:function(a){void 0!=a&&(riaShare.initItems(a),window.startArticleJS(a));window.instgrm.Embeds.process()},getAuto:function(){var a=this;ria_sock&&ria_sock.on("bus_notify",function(b){var c=b.article_id,d=b.subtype;if(c==a.params.dataAjax.id)switch(d){case "article_block_create":a.createMsg(b,a.elems.articleList);break;case "article_widget_block_create":a.createMsg(b,a.elems.widgetList+'[data-list-id="'+c+'"]');break;case "article_block_update":a.updateMsg(b,a.elems.articleList).updateCaption(b);
break;case "article_widget_block_update":a.updateMsg(b,a.elems.widgetList+'[data-list-id="'+c+'"]');break;case "article_block_delete":a.deleteMsg(b,a.elems.articleList);break;case "article_widget_block_delete":a.deleteMsg(b,a.elems.widgetList+'[data-list-id="'+c+'"]');break;default:console.log("")}})},getWidgetTop:function(a){var b=this;$.ajax({url:b.urls.menu+a+".html"}).done(function(a){a=$(a);b.getView(a);$(b.elems.widgetHead).html(a)})},createMsg:function(a,b){var c=$(a.content),d=$(b);this.getView(c);
"desc"===this.params.dataAjax.sort?d.prepend(c):d.append(c);return this},deleteMsg:function(a,b){var c=a.article_block_id;$(b).find('[data-id="'+c+'"]').remove();return this},updateMsg:function(a,b){var c=a.article_id,d=a.article_block_id,e=a.article_block_is_pinned,f=$(a.content),g=$(b);this.getView(f);this.updatePinned(e,c,d,f);g.find('[data-id="'+d+'"]').replaceWith(f);return this},updatePinned:function(a,b,c,d){b=$('.online__pinned[data-id="'+b+'"]');c=b.find('[data-id="'+c+'"]');if(c.length)switch(a){case 0:c.remove();
break;case 1:c.replaceWith(d);break;default:console.log("")}else switch(a){case 0:break;case 1:b.append(d);break;default:console.log("")}return this},updateCaption:function(a,b){var c=a.article_block_id,d=a.article_block_is_active;if($(this.elems.captionContent).find('[data-id="'+c+'"]').length)switch(d){case 0:$(this.elems.captionContent).find('[data-id="'+c+'"]').hide();break;case 1:$(this.elems.captionContent).find('[data-id="'+c+'"]').show();break;default:console.log("")}return this},sortMsg:function(){var a=
this;$(a.elems.article).on("click",a.elems.sortCtrl,function(b){b.preventDefault();b=$(this);b.hasClass("m-active")||(b.addClass("m-active").siblings(".online__sort-button").removeClass("m-active"),b=b.data("order"),a.setParam("sort",b).setParam("on_page","20").setParam("order").setParam("from").setParam("get").setParam("inclusive").getMsg(a.elems.articleList,!1),a.params.isLoaded=!1,a.deleteMoreBtn())});$(a.elems.widget).on("click",a.elems.sortCtrl,function(b){b.preventDefault();b=$(this);b.hasClass("m-active")||
(b.addClass("m-active").siblings(".online__sort-button").removeClass("m-active"),a.setParam("sort",b.data("order")).setParam("on_page","20").setParam("order").setParam("from").setParam("get").setParam("inclusive").getMsg(a.elems.widgetList,!1),a.params.isLoaded=!1)})},moreBtn:function(a,b){var c=this,d=$("<span />").addClass("online__morebtn").text("\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0435\u0435");$(c.elems.sort).find(".online__morebtn").length||
$(c.elems.sort).append(d);$(".online__morebtn").on("click",function(){var b=$(a).find(".online__item").first().data("sortkey");c.setParam("sort").setParam("from",b).setParam("inclusive",0).setParam("get","previous").getMsg(a,"prepend")});return this},deleteMoreBtn:function(){$(".online__morebtn").length&&$(".online__morebtn").remove()},captionMsg:function(){var a=this;$(a.elems.widget).on("click",".online__caption-title",function(){a.params.isLoaded||a.setParam("on_page","all").getMsg(a.elems.widgetList,
!1);$(a.elems.widget).toggleClass("m-close")});$(a.elems.article).on("click",".online__caption-title",function(){$(a.elems.article).find(".online__caption").toggleClass("m-close")});$(a.elems.article).on("click",".online__caption-item",function(b){b.preventDefault();$(this).data("id");b=$(this).data("sortkey");var c=$(a.elems.articleList).offset();a.setParam("from",b).setParam("inclusive",1).setParam("get","next").setParam("order","new_first").setParam("sort","desc").getMsg(a.elems.articleList,!1).moreBtn(a.elems.articleList,
b);$(a.elems.sortCtrl).eq(0).addClass("m-active").siblings(".online__sort-button").removeClass("m-active");0==a.params.isLoaded;window.scrollTo({top:c.top-50});return!1})}};onlineStream.init()});
